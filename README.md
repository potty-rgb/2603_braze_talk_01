# Braze 알림톡 Liquid 변환기

카카오 알림톡 템플릿을 Braze Liquid 코드로 자동 변환하는 웹 서비스입니다.

비즈뿌리오(비뿌) 템플릿 원문과 발송 원문을 입력하면, Braze 메시지 에디터에 바로 붙여넣기 가능한 Liquid 코드를 생성합니다.

## 접속 방법

- **서비스 URL**: https://potty-rgb.github.io/2603_braze_talk_01/
- **로컬 개발**: `npm install && npm run dev` → http://localhost:5173

---

## 사용 방법

### 홈화면

서비스에 접속하면 3가지 기능 카드가 표시됩니다.

| 카드 | 설명 |
|------|------|
| **버튼 O 템플릿** | 버튼(웹링크)이 포함된 알림톡 → Liquid 변환 |
| **버튼 X 템플릿** | 버튼 없이 텍스트만 있는 알림톡 → Liquid 변환 |
| **오류 해결하기** | Braze 발송 오류 진단 및 자동 수정 (Liquid 변환 없이 바로 사용) |

### Step 1. 템플릿 유형 선택

버튼 O 또는 버튼 X 카드를 클릭하여 시작합니다.

### Step 2. 정보 입력

#### 공통 필드

| 필드 | 설명 | 입력 예시 |
|------|------|----------|
| **템플릿 원문** | 비뿌 템플릿 원본 그대로 복사 (`#{변수}` 포함) | `#{강의명}의 #{쿠폰내용} 쿠폰이 오늘 밤에 마감돼요!` |
| **발송 원문** | 변수값이 치환된 최종 발송 문안 | `<2026NEW! 서울투자 기초반>의 재수강 투자 응원 6만원 쿠폰이...` |
| **템플릿 코드** | 비즈뿌리오에 등록된 템플릿 코드 | `bizp_2025123103044120835684085` |
| **알림톡 타입** | AT(알림톡) 또는 AI(이미지 알림톡) | 드롭다운 선택 |
| **메시지 유형** | info(정보성) 또는 ad(광고성) | 드롭다운 선택 |

#### 버튼 O 추가 필드

| 필드 | 설명 | 입력 예시 |
|------|------|----------|
| **버튼명** | 비뿌 템플릿 버튼명 그대로 | `자세히 보기🎁` |
| **url변수** | 비뿌 버튼 URL 변수 (빈값 허용) | `https://` |
| **UTM** | 생성한 UTM 원본 그대로 | `https://weolbu.com/event?utm_source=katalk&...` |

### Step 3. 결과 확인 및 복사

- **변수 매칭 결과**: 자동 추출된 변수, 값, 영어 변수명 확인 (수정 가능)
- **Liquid 코드**: 섹션별 색상 구분 (파란색 = 확인 필요, 회색 = 고정)
- **전체 복사** 버튼 → Braze 메시지 에디터에 붙여넣기

---

## 주요 기능

### 변수 자동 변환

템플릿 원문의 `#{한글변수명}`을 자동으로 영어 변수명으로 변환합니다.

- **사전 매칭**: 약 87개의 자주 사용되는 한글 변수명이 등록되어 있습니다
  - 예: `#{강의명}` → `lecture_name`, `#{만료일시}` → `expiration_datetime`
- **로마자 자동생성**: 사전에 없는 변수는 한글 로마자 변환으로 자동 생성됩니다
  - 예: `#{수강생이름}` → `su_gang_saeng_i_reum`
- 자동 생성된 변수명은 "자동생성" 뱃지로 표시되며, 직접 수정할 수 있습니다

### 오류 진단 기능 (대화형 UI)

Braze 테스트 발송 시 오류가 발생했을 때 원인을 진단하고 자동으로 수정합니다.

#### 접근 방법
- **홈화면**: "오류 해결하기" 카드 클릭 → Liquid 코드 + 오류 메시지 입력
- **Step 3 결과 화면**: 상단의 "오류 진단" 패널이 자동으로 열림 → 오류 메시지만 입력

#### 대화형 진단 흐름
채팅 형태의 UI에서 여러 오류를 연속으로 진단할 수 있습니다.

1. **오류 메시지 입력**: Braze 테스트 발송 시 받은 오류를 그대로 붙여넣기
2. **자동 진단**: 원인 분석 + 수정 내역 표시 + 수정된 코드 복사
3. **반복 진단**: 다른 오류가 있으면 바로 이어서 입력

#### 지원하는 오류 유형

| 오류 | 원인 | 자동 수정 |
|------|------|----------|
| `Unexpected token \t` | 탭 문자 혼입 | 탭 → 공백 치환 |
| `Unexpected token \n` | 줄바꿈 혼입 | 줄바꿈 제거 |
| `Unexpected token "` | 큰따옴표 미이스케이프 | `"` → `\"` |
| `Unexpected token '` | 작은따옴표 충돌 | `'` → `\'` |
| `Unexpected token \` | 백슬래시 미이스케이프 | `\` → `\\` |
| 기타 | 구조적 오류 | AI 서비스 안내 |

#### AI 연동 + 해결방안 저장
- 자동 진단이 어려운 오류: 오류 메시지 + Liquid 코드를 한 번에 복사하여 AI 서비스에 붙여넣기
- AI로 해결한 방안을 저장하면 다음에 동일 오류 발생 시 자동 제안
- **Google Sheets 연동**: 해결방안이 Google Sheets에 저장되어 팀원 간 공유 가능

---

## 예시 데이터

### 세트 1: 버튼 O / AT / info

| 필드 | 값 |
|------|-----|
| 템플릿 원문 | `#{강의명}의 #{쿠폰내용} 쿠폰이 오늘 밤에 마감돼요!`<br>`■ 쿠폰명: #{쿠폰이름} ■ 만료일시: #{만료일시}` |
| 발송 원문 | `<2026NEW! 서울투자 기초반>의 재수강 투자 응원 6만원 쿠폰이 오늘 밤에 마감돼요!`<br>`■ 쿠폰명: 재수강 투자 응원 6만원 쿠폰 ■ 만료일시: 01.29(목) 23:59까지` |
| 템플릿 코드 | `bizp_2025123103044120835684085` |
| 알림톡 타입 | AT |
| 메시지 유형 | info |
| 버튼명 | `자세히 보기🎁` |
| url변수 | `https://` |
| UTM | `https://weolbu.com/event?utm_source=katalk&utm_medium=alimtalk` |

### 세트 2: 버튼 X / AT / info

| 필드 | 값 |
|------|-----|
| 템플릿 원문 | `#{고객명}님의 주문이 발송되었습니다.`<br>`■ 주문번호: #{주문번호}`<br>`■ 상품명: #{상품명}`<br>`■ 택배사: #{택배사명} (#{송장번호})`<br>`■ 배송예정일: #{배송예정일}` |
| 발송 원문 | `김철수님의 주문이 발송되었습니다.`<br>`■ 주문번호: ORD-20260226-0042`<br>`■ 상품명: 월부 투자 노트 세트`<br>`■ 택배사: CJ대한통운 (629183740281)`<br>`■ 배송예정일: 02.28(금)` |
| 템플릿 코드 | `bizp_2026022601234567890123456` |
| 알림톡 타입 | AT |
| 메시지 유형 | info |

### 세트 3: 버튼 O / AI / ad (www 포함 URL)

| 필드 | 값 |
|------|-----|
| 템플릿 원문 | `#{이름}님, #{강의명} 수강생 전용 혜택!`<br>`#{쿠폰내용} 쿠폰이 도착했어요.`<br>`■ 쿠폰코드: #{쿠폰코드}`<br>`■ 만료일시: #{만료일시}` |
| 발송 원문 | `박영희님, <2026 부동산 실전반> 수강생 전용 혜택!`<br>`수강료 10만원 할인 쿠폰이 도착했어요.`<br>`■ 쿠폰코드: REAL2026-VIP`<br>`■ 만료일시: 03.31(월) 23:59까지` |
| 템플릿 코드 | `bizp_2026030103044120835612345` |
| 알림톡 타입 | AI |
| 메시지 유형 | ad |
| 버튼명 | `쿠폰 사용하기` |
| url변수 | `https://` |
| UTM | `https://www.weolbu.com/coupon?utm_source=katalk&utm_medium=alimtalk&utm_campaign=vip_coupon` |

---

## Google Sheets 연동 (오류 해결방안 공유 DB)

오류 진단 기능의 해결방안을 팀원 간 공유하기 위해 Google Sheets를 사용합니다.

> 현재 Google Sheets 연동이 설정되어 있어 바로 사용 가능합니다.

### 설정 방법 (재설정이 필요한 경우)

#### 1단계: Google Sheet 생성

1. [Google Sheets](https://sheets.google.com)에서 새 스프레드시트 생성
2. **시트1**의 1행(헤더)에 아래 컬럼명 입력:

| A | B | C | D |
|---|---|---|---|
| errorPattern | description | fixedCode | savedAt |

#### 2단계: Apps Script 배포

1. 생성한 Google Sheet에서 **확장 프로그램 > Apps Script** 클릭
2. 기본 코드를 모두 지우고, 프로젝트 내 `google-apps-script/Code.gs` 파일의 내용을 전체 복사하여 붙여넣기
3. **배포 > 새 배포** 클릭
4. 유형: **웹 앱** 선택
5. 설정:
   - 실행 주체: **나**
   - 액세스 권한: **모든 사용자**
6. **배포** 클릭 → 웹 앱 URL 복사

#### 3단계: 프로젝트에 URL 설정

`src/utils/errorStore.ts` 파일의 `SHEET_CONFIG`에 복사한 URL 입력:

```typescript
const SHEET_CONFIG = {
  readUrl: 'https://script.google.com/macros/s/여기에_배포_URL/exec',
  writeUrl: 'https://script.google.com/macros/s/여기에_배포_URL/exec',
};
```

> readUrl과 writeUrl에 **동일한 URL**을 입력합니다.

#### 4단계: 빌드 및 배포

```bash
npm run build
# gh-pages 브랜치에 배포
```

---

## 기술 스택

| 기술 | 버전 |
|------|------|
| React | 19.0.0 |
| TypeScript | 5.7 |
| Vite | 6.0.0 |
| Tailwind CSS | 4.0.0 |

## 로컬 개발

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 프로덕션 빌드
npm run build
```
